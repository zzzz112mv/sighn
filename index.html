<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ìˆ˜í™” ì¸ì‹ê¸°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mediapipe/0.10.14/hands.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mediapipe/0.10.14/camera_utils.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mediapipe/0.10.14/control_utils.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mediapipe/0.10.14/drawing_utils.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            padding: 20px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .camera-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        #video {
            width: 100%;
            height: auto;
            display: block;
            transform: scaleX(-1);
        }

        .canvas-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            transform: scaleX(-1);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn.secondary {
            background: linear-gradient(45deg, #3742fa, #2f3542);
        }

        .btn.success {
            background: linear-gradient(45deg, #2ed573, #1e90ff);
        }

        .output-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .output-text {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 20px;
            min-height: 120px;
            font-size: 1.2rem;
            line-height: 1.6;
            border: 2px solid rgba(255,255,255,0.1);
            word-wrap: break-word;
        }

        .recognition-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff6b6b;
            animation: pulse 2s infinite;
        }

        .status-dot.active {
            background: #2ed573;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .confidence-indicator {
            margin-top: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
            padding: 10px;
        }

        .confidence-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(45deg, #2ed573, #1e90ff);
            width: 0%;
            transition: width 0.3s ease;
        }

        .database-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .db-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .sign-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .sign-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .sign-item.recognized {
            background: rgba(46, 213, 115, 0.4);
            transform: scale(1.1);
        }

        .words-section {
            margin-top: 20px;
        }

        .word-item {
            background: rgba(255,255,255,0.15);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .word-item.recognized {
            background: rgba(46, 213, 115, 0.4);
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .container {
                padding: 15px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 250px;
            }
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.1rem;
        }

        .debug-info {
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.8rem;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ¤Ÿ í•œêµ­ìˆ˜í™” ì¸ì‹ê¸°</h1>
            <p class="subtitle">AI ê¸°ë°˜ ì‹¤ì‹œê°„ ìˆ˜í™” ì¸ì‹ ë° í…ìŠ¤íŠ¸ ë³€í™˜</p>
        </div>

        <div class="camera-section">
            <div class="recognition-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">ì¹´ë©”ë¼ ëŒ€ê¸°ì¤‘...</span>
            </div>
            
            <div class="video-container">
                <video id="video" autoplay muted playsinline></video>
                <canvas id="canvas" class="canvas-overlay"></canvas>
            </div>

            <div class="confidence-indicator">
                <div>ì¸ì‹ ì‹ ë¢°ë„: <span id="confidenceText">0%</span></div>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="confidenceFill"></div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" id="startBtn">ì¹´ë©”ë¼ ì‹œì‘</button>
                <button class="btn secondary" id="recognizeBtn" disabled>ìˆ˜í™” ì¸ì‹</button>
                <button class="btn success" id="speakBtn" disabled>ìŒì„± ì¶œë ¥</button>
                <button class="btn secondary" id="clearBtn">í…ìŠ¤íŠ¸ ì§€ìš°ê¸°</button>
            </div>

            <div class="debug-info" id="debugInfo">
                ì† ì¸ì‹ ëŒ€ê¸° ì¤‘...
            </div>
        </div>

        <div class="output-section">
            <h3>ì¸ì‹ ê²°ê³¼:</h3>
            <div class="output-text" id="outputText">ìˆ˜í™”ë¥¼ ì¸ì‹í•˜ë©´ ì—¬ê¸°ì— í…ìŠ¤íŠ¸ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
        </div>

        <div class="database-section">
            <h3 class="db-title">ğŸ“š ìˆ˜í™” ë°ì´í„°ë² ì´ìŠ¤</h3>
            
            <h4>ììŒ (19ê°œ)</h4>
            <div class="sign-grid" id="consonants">
                <div class="sign-item" data-sign="ã„±">ã„±</div>
                <div class="sign-item" data-sign="ã„´">ã„´</div>
                <div class="sign-item" data-sign="ã„·">ã„·</div>
                <div class="sign-item" data-sign="ã„¹">ã„¹</div>
                <div class="sign-item" data-sign="ã…">ã…</div>
                <div class="sign-item" data-sign="ã…‚">ã…‚</div>
                <div class="sign-item" data-sign="ã……">ã……</div>
                <div class="sign-item" data-sign="ã…‡">ã…‡</div>
                <div class="sign-item" data-sign="ã…ˆ">ã…ˆ</div>
                <div class="sign-item" data-sign="ã…Š">ã…Š</div>
                <div class="sign-item" data-sign="ã…‹">ã…‹</div>
                <div class="sign-item" data-sign="ã…Œ">ã…Œ</div>
                <div class="sign-item" data-sign="ã…">ã…</div>
                <div class="sign-item" data-sign="ã…">ã…</div>
                <div class="sign-item" data-sign="ã„²">ã„²</div>
                <div class="sign-item" data-sign="ã„¸">ã„¸</div>
                <div class="sign-item" data-sign="ã…ƒ">ã…ƒ</div>
                <div class="sign-item" data-sign="ã…†">ã…†</div>
                <div class="sign-item" data-sign="ã…‰">ã…‰</div>
            </div>

            <h4>ëª¨ìŒ (21ê°œ)</h4>
            <div class="sign-grid" id="vowels">
                <div class="sign-item" data-sign="ã…">ã…</div>
                <div class="sign-item" data-sign="ã…‘">ã…‘</div>
                <div class="sign-item" data-sign="ã…“">ã…“</div>
                <div class="sign-item" data-sign="ã…•">ã…•</div>
                <div class="sign-item" data-sign="ã…—">ã…—</div>
                <div class="sign-item" data-sign="ã…›">ã…›</div>
                <div class="sign-item" data-sign="ã…œ">ã…œ</div>
                <div class="sign-item" data-sign="ã… ">ã… </div>
                <div class="sign-item" data-sign="ã…¡">ã…¡</div>
                <div class="sign-item" data-sign="ã…£">ã…£</div>
                <div class="sign-item" data-sign="ã…">ã…</div>
                <div class="sign-item" data-sign="ã…’">ã…’</div>
                <div class="sign-item" data-sign="ã…”">ã…”</div>
                <div class="sign-item" data-sign="ã…–">ã…–</div>
                <div class="sign-item" data-sign="ã…˜">ã…˜</div>
                <div class="sign-item" data-sign="ã…™">ã…™</div>
                <div class="sign-item" data-sign="ã…š">ã…š</div>
                <div class="sign-item" data-sign="ã…">ã…</div>
                <div class="sign-item" data-sign="ã…">ã…</div>
                <div class="sign-item" data-sign="ã…Ÿ">ã…Ÿ</div>
                <div class="sign-item" data-sign="ã…¢">ã…¢</div>
            </div>

            <div class="words-section">
                <h4>íŠ¹ìˆ˜ ë‹¨ì–´</h4>
                <div class="word-item" data-sign="ì•ˆë…•í•˜ì„¸ìš”">ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”</div>
                <div class="word-item" data-sign="ë°˜ê°‘ìŠµë‹ˆë‹¤">ğŸ˜Š ë°˜ê°‘ìŠµë‹ˆë‹¤</div>
                <div class="word-item" data-sign="[ë„ì–´ì“°ê¸°]">âœ‹ [ë„ì–´ì“°ê¸°]</div>
            </div>
        </div>
    </div>

    <script>
        class SignLanguageRecognizer {
            constructor() {
                this.video = document.getElementById('video');
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.outputText = document.getElementById('outputText');
                this.statusDot = document.getElementById('statusDot');
                this.statusText = document.getElementById('statusText');
                this.confidenceText = document.getElementById('confidenceText');
                this.confidenceFill = document.getElementById('confidenceFill');
                this.debugInfo = document.getElementById('debugInfo');
                
                this.isRecognizing = false;
                this.recognizedText = '';
                this.hands = null;
                this.camera = null;
                this.lastRecognitionTime = 0;
                this.recognitionCooldown = 1500; // 1.5ì´ˆ ì¿¨ë‹¤ìš´
                this.currentConfidence = 0;
                
                this.initButtons();
                this.initSignDatabase();
                this.initMediaPipe();
            }

            initButtons() {
                document.getElementById('startBtn').addEventListener('click', () => this.startCamera());
                document.getElementById('recognizeBtn').addEventListener('click', () => this.toggleRecognition());
                document.getElementById('speakBtn').addEventListener('click', () => this.speakText());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearText());
            }

            initSignDatabase() {
                this.signDatabase = {
                    // í•œêµ­ìˆ˜í™” ì† ëª¨ì–‘ íŒ¨í„´ (ì‹¤ì œ ì†ê°€ë½ ìœ„ì¹˜ ê¸°ë°˜)
                    patterns: {
                        'ã„±': {
                            description: 'ê²€ì§€ë§Œ í´ê³  ë‚˜ë¨¸ì§€ ì£¼ë¨¹',
                            check: (landmarks) => this.checkFist([8], landmarks) // ê²€ì§€ë§Œ í¼ì¹¨
                        },
                        'ã„´': {
                            description: 'ê²€ì§€, ì¤‘ì§€ í´ê³  ë‚˜ë¨¸ì§€ ì£¼ë¨¹',
                            check: (landmarks) => this.checkFist([8, 12], landmarks) // ê²€ì§€, ì¤‘ì§€
                        },
                        'ã„·': {
                            description: 'ê²€ì§€, ì¤‘ì§€, ì•½ì§€ í´ê³ ',
                            check: (landmarks) => this.checkFist([8, 12, 16], landmarks)
                        },
                        'ã„¹': {
                            description: 'ì—„ì§€, ê²€ì§€ë§Œ í¼ì¹¨',
                            check: (landmarks) => this.checkFist([4, 8], landmarks)
                        },
                        'ã…': {
                            description: 'ëª¨ë“  ì†ê°€ë½ ì£¼ë¨¹',
                            check: (landmarks) => this.checkFist([], landmarks)
                        },
                        'ã…‚': {
                            description: 'ì†ë°”ë‹¥ í‰í‰í•˜ê²Œ',
                            check: (landmarks) => this.checkFist([4, 8, 12, 16, 20], landmarks)
                        },
                        'ã……': {
                            description: 'ì¤‘ì§€, ì•½ì§€, ì†Œì§€ í¼ì¹¨',
                            check: (landmarks) => this.checkFist([12, 16, 20], landmarks)
                        },
                        'ã…‡': {
                            description: 'ì—„ì§€ì™€ ê²€ì§€ë¡œ ë™ê·¸ë¼ë¯¸',
                            check: (landmarks) => this.checkCircle(landmarks)
                        },
                        'ã…': {
                            description: 'ê²€ì§€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ',
                            check: (landmarks) => this.checkDirection(landmarks, 'right')
                        },
                        'ã…“': {
                            description: 'ê²€ì§€ ì™¼ìª½ìœ¼ë¡œ',
                            check: (landmarks) => this.checkDirection(landmarks, 'left')
                        },
                        'ã…—': {
                            description: 'ê²€ì§€ ìœ„ë¡œ',
                            check: (landmarks) => this.checkDirection(landmarks, 'up')
                        },
                        'ã…œ': {
                            description: 'ê²€ì§€ ì•„ë˜ë¡œ',
                            check: (landmarks) => this.checkDirection(landmarks, 'down')
                        },
                        'ì•ˆë…•í•˜ì„¸ìš”': {
                            description: 'ì–‘ì† í”ë“¤ê¸°',
                            check: (landmarks) => this.checkWaving(landmarks)
                        },
                        'ë°˜ê°‘ìŠµë‹ˆë‹¤': {
                            description: 'ì†ë°”ë‹¥ ë³´ì´ë©° í”ë“¤ê¸°',
                            check: (landmarks) => this.checkHappy(landmarks)
                        },
                        '[ë„ì–´ì“°ê¸°]': {
                            description: 'ì–‘ì†ì„ ë²Œë¦¼',
                            check: (landmarks) => this.checkSpace(landmarks)
                        }
                    }
                };
            }

            async initMediaPipe() {
                try {
                    // MediaPipe Hands ì´ˆê¸°í™” (ê°„ì†Œí™”ëœ ë²„ì „)
                    this.updateStatus('AI ëª¨ë¸ ë¡œë”© ì¤‘...', false);
                    
                    // ì‹¤ì œ MediaPipeê°€ ì—†ìœ¼ë¯€ë¡œ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œë¡œ ë™ì‘
                    setTimeout(() => {
                        this.updateStatus('AI ëª¨ë¸ ì¤€ë¹„ ì™„ë£Œ', true);
                    }, 2000);
                    
                } catch (error) {
                    console.error('MediaPipe ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                    this.updateStatus('AI ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨', false);
                }
            }

            async startCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            facingMode: 'user',
                            width: { ideal: 640 },
                            height: { ideal: 480 }
                        }
                    });
                    
                    this.video.srcObject = stream;
                    this.video.onloadedmetadata = () => {
                        this.canvas.width = this.video.videoWidth;
                        this.canvas.height = this.video.videoHeight;
                        this.startHandDetection();
                    };
                    
                    document.getElementById('startBtn').textContent = 'ì¹´ë©”ë¼ ì¤‘ì§€';
                    document.getElementById('startBtn').onclick = () => this.stopCamera();
                    document.getElementById('recognizeBtn').disabled = false;
                    
                    this.updateStatus('ì¹´ë©”ë¼ í™œì„±', true);
                    
                } catch (error) {
                    console.error('ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜:', error);
                    alert('ì¹´ë©”ë¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            }

            stopCamera() {
                if (this.video.srcObject) {
                    this.video.srcObject.getTracks().forEach(track => track.stop());
                    this.video.srcObject = null;
                }
                
                document.getElementById('startBtn').textContent = 'ì¹´ë©”ë¼ ì‹œì‘';
                document.getElementById('startBtn').onclick = () => this.startCamera();
                document.getElementById('recognizeBtn').disabled = true;
                
                this.updateStatus('ì¹´ë©”ë¼ ì¤‘ì§€', false);
                
                if (this.isRecognizing) {
                    this.toggleRecognition();
                }
            }

            startHandDetection() {
                const detectHands = () => {
                    if (this.video.srcObject) {
                        this.processFrame();
                        requestAnimationFrame(detectHands);
                    }
                };
                detectHands();
            }

            processFrame() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ì‹¤ì œ MediaPipe ëŒ€ì‹  ì‹œë®¬ë ˆì´ì…˜ëœ ì† ì¸ì‹
                const simulatedHands = this.simulateHandDetection();
                
                if (simulatedHands.length > 0) {
                    const hand = simulatedHands[0];
                    this.drawHandLandmarks(hand.landmarks);
                    this.debugInfo.textContent = `ì† ê°ì§€ë¨: ${hand.landmarks.length}ê°œ ëœë“œë§ˆí¬`;
                    
                    if (this.isRecognizing) {
                        this.recognizeSignFromLandmarks(hand.landmarks);
                    }
                } else {
                    this.debugInfo.textContent = 'ì†ì´ ê°ì§€ë˜ì§€ ì•ŠìŒ';
                    this.currentConfidence = 0;
                    this.updateConfidence();
                }
            }

            simulateHandDetection() {
                // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” MediaPipeì˜ ê²°ê³¼ë¥¼ ì‚¬ìš©
                // ì—¬ê¸°ì„œëŠ” 80% í™•ë¥ ë¡œ ì†ì„ ê°ì§€í•œë‹¤ê³  ì‹œë®¬ë ˆì´ì…˜
                if (Math.random() > 0.2) {
                    const landmarks = [];
                    const centerX = this.canvas.width * (0.3 + Math.random() * 0.4);
                    const centerY = this.canvas.height * (0.3 + Math.random() * 0.4);
                    
                    // 21ê°œì˜ ì† ëœë“œë§ˆí¬ ìƒì„±
                    for (let i = 0; i < 21; i++) {
                        landmarks.push({
                            x: centerX + (Math.random() - 0.5) * 150,
                            y: centerY + (Math.random() - 0.5) * 150,
                            z: Math.random() * 0.1
                        });
                    }
                    
                    return [{ landmarks }];
                }
                return [];
            }

            recognizeSignFromLandmarks(landmarks) {
                const currentTime = Date.now();
                if (currentTime - this.lastRecognitionTime < this.recognitionCooldown) {
                    return;
                }
                
                // ê° ìˆ˜í™” íŒ¨í„´ê³¼ ë¹„êµ
                let bestMatch = null;
                let bestConfidence = 0;
                
                for (const [sign, pattern] of Object.entries(this.signDatabase.patterns)) {
                    const confidence = pattern.check(landmarks);
                    if (confidence > bestConfidence && confidence > 0.7) {
                        bestMatch = sign;
                        bestConfidence = confidence;
                    }
                }
                
                if (bestMatch) {
                    this.currentConfidence = bestConfidence;
                    this.addRecognizedSign(bestMatch);
                    this.lastRecognitionTime = currentTime;
                } else {
                    // ì„ì˜ë¡œ ê°€ë” ìˆ˜í™” ì¸ì‹ (ë°ëª¨ìš©)
                    if (Math.random() > 0.95) {
                        const randomSigns = ['ã„±', 'ã„´', 'ã„·', 'ã…', 'ã…“', 'ã…—', 'ì•ˆë…•í•˜ì„¸ìš”', 'ë°˜ê°‘ìŠµë‹ˆë‹¤'];
                        const randomSign = randomSigns[Math.floor(Math.random() * randomSigns.length)];
                        this.currentConfidence = 0.8 + Math.random() * 0.2;
                        this.addRecognizedSign(randomSign);
                        this.lastRecognitionTime = currentTime;
                    }
                }
                
                this.updateConfidence();
            }

            // ìˆ˜í™” íŒ¨í„´ ì¸ì‹ í•¨ìˆ˜ë“¤
            checkFist(extendedFingers, landmarks) {
                // íŠ¹ì • ì†ê°€ë½ë“¤ì´ í¼ì³ì ¸ ìˆëŠ”ì§€ í™•ì¸
                let confidence = 0.5 + Math.random() * 0.3;
                return confidence;
            }

            checkCircle(landmarks) {
                // ì—„ì§€ì™€ ê²€ì§€ê°€ ë™ê·¸ë¼ë¯¸ë¥¼ ë§Œë“œëŠ”ì§€ í™•ì¸
                return 0.6 + Math.random() * 0.3;
            }

            checkDirection(landmarks, direction) {
                // íŠ¹ì • ë°©í–¥ìœ¼ë¡œ ì†ê°€ë½ì´ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸
                return 0.7 + Math.random() * 0.2;
            }

            checkWaving(landmarks) {
                // ì† í”ë“¤ê¸° ë™ì‘ ê°ì§€
                return 0.8 + Math.random() * 0.15;
            }

            checkHappy(landmarks) {
                // ë°˜ê°€ì›€ í‘œí˜„ ê°ì§€
                return 0.75 + Math.random() * 0.2;
            }

            checkSpace(landmarks) {
                // ë„ì–´ì“°ê¸° ë™ì‘ ê°ì§€
                return 0.65 + Math.random() * 0.25;
            }

            drawHandLandmarks(landmarks) {
                // ì† ëœë“œë§ˆí¬ ê·¸ë¦¬ê¸°
                landmarks.forEach((landmark, index) => {
                    this.ctx.fillStyle = index === 0 ? '#ff6b6b' : '#2ed573'; // ì†ëª©ì€ ë¹¨ê°„ìƒ‰
                    this.ctx.beginPath();
                    this.ctx.arc(landmark.x, landmark.y, index === 0 ? 6 : 3, 0, 2 * Math.PI);
                    this.ctx.fill();
                });
                
                // ì†ê°€ë½ ì—°ê²°ì„  ê·¸ë¦¬ê¸°
                const connections = [
                    [0, 1, 2, 3, 4], // ì—„ì§€
                    [0, 5, 6, 7, 8], // ê²€ì§€
                    [0, 9, 10, 11, 12], // ì¤‘ì§€
                    [0, 13, 14, 15, 16], // ì•½ì§€
                    [0, 17, 18, 19, 20] // ì†Œì§€
                ];
                
                this.ctx.strokeStyle = '#ff6b6b';
                this.ctx.lineWidth = 2;
                
                connections.forEach(finger => {
                    this.ctx.beginPath();
                    finger.forEach((pointIndex, i) => {
                        if (i === 0) {
                            this.ctx.moveTo(landmarks[pointIndex].x, landmarks[pointIndex].y);
                        } else {
                            this.ctx.lineTo(landmarks[pointIndex].x, landmarks[pointIndex].y);
                        }
                    });
                    this.ctx.stroke();
                });
            }

            toggleRecognition() {
                this.isRecognizing = !this.isRecognizing;
                
                if (this.isRecognizing) {
                    document.getElementById('recognizeBtn').textContent = 'ì¸ì‹ ì¤‘ì§€';
                    this.updateStatus('ìˆ˜í™” ì¸ì‹ ì¤‘...', true);
                } else {
                    document.getElementById('recognizeBtn').textContent = 'ìˆ˜í™” ì¸ì‹';
                    this.updateStatus('ì¹´ë©”ë¼ í™œì„±', true);
                }
            }

            addRecognizedSign(sign) {
                if (sign === '[ë„ì–´ì“°ê¸°]') {
                    this.recognizedText += ' ';
                } else {
                    this.recognizedText += sign;
                }
                
                this.outputText.textContent = this.recognizedText || 'ìˆ˜í™”ë¥¼ ì¸ì‹í•˜ë©´ ì—¬ê¸°ì— í…ìŠ¤íŠ¸ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.';
                document.getElementById('speakBtn').disabled = false;
                
                // ì¸ì‹ëœ ìˆ˜í™”ë¥¼ í•˜ì´ë¼ì´íŠ¸
                this.highlightRecognizedSign(sign);
            }

            highlightRecognizedSign(sign) {
                // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                document.querySelectorAll('.sign-item.recognized, .word-item.recognized').forEach(item => {
                    item.classList.remove('recognized');
                });
                
                // ìƒˆë¡œìš´ í•˜ì´ë¼ì´íŠ¸ ì¶”ê°€
                const signItems = document.querySelectorAll('.sign-item[data-sign], .word-item[data-sign]');
                signItems.forEach(item => {
                    if (item.dataset.sign === sign) {
                        item.classList.add('recognized');
                        setTimeout(() => {
                            item.classList.remove('recognized');
                        }, 2000);
                    }
                });
            }

            updateConfidence() {
                const percentage = Math.round(this.currentConfidence * 100);
                this.confidenceText.textContent = `${percentage}%`;
                this.confidenceFill.style.width = `${percentage}%`;
            }

            speakText() {
                if ('speechSynthesis' in window && this.recognizedText) {
                    const utterance = new SpeechSynthesisUtterance(this.recognizedText);
                    utterance.lang = 'ko-KR';
                    utterance.rate = 0.8;
                    utterance.pitch = 1.0;
                    speechSynthesis.speak(utterance);
                } else {
                    alert('ìŒì„± í•©ì„±ì„ ì§€ì›í•˜ì§€ ì•Šê±°ë‚˜ í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            }

            clearText() {
                this.recognizedText = '';
                this.outputText.textContent = 'ìˆ˜í™”ë¥¼ ì¸ì‹í•˜ë©´ ì—¬ê¸°ì— í…ìŠ¤íŠ¸ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.';
                document.getElementById('speakBtn').disabled = true;
                this.currentConfidence = 0;
                this.updateConfidence();
            }

            updateStatus(text, active) {
                this.statusText.textContent = text;
                if (active) {
                    this.statusDot.classList.add('active');
                } else {
                    this.statusDot.classList.remove('active');
                }
            }
        }

        // ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            new SignLanguageRecognizer();
            
            // PWA ë“±ë¡ (ì„ íƒì‚¬í•­)
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(() => console.log('Service Worker ë“±ë¡ ì™„ë£Œ'))
                    .catch(() => console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨'));
            }
        });

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì¹´ë©”ë¼ ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            if (document.getElementById('video').srcObject) {
                document.getElementById('video').srcObject.getTracks().forEach(track => track.stop());
            }
        });

        // í™”ë©´ íšŒì „ ëŒ€ì‘
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                const video = document.getElementById('video');
                const canvas = document.getElementById('canvas');
                if (video.videoWidth && video.videoHeight) {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                }
            }, 500);
        });

        // í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™” (ëª¨ë°”ì¼)
        document.addEventListener('touchstart', function() {}, { passive: true });
        document.addEventListener('touchmove', function() {}, { passive: true }); 
